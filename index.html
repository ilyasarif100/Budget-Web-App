<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="accelerometer=*, encrypted-media=*">
    <title>Budget Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon (data URI SVG to avoid 404) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
</head>
<body>
    <!-- Top Dashboard Bar -->
    <header class="dashboard-header">
        <div class="dashboard-content">
            <div class="dashboard-item">
                <span class="dashboard-label">Current Month</span>
                <span class="dashboard-value" id="current-month">January 2024</span>
            </div>
            <div class="dashboard-item">
                <span class="dashboard-label">Total Balance</span>
                <div class="dashboard-value-container">
                    <span class="dashboard-value balance" id="total-balance">$0.00</span>
                    <button class="btn-icon-small" id="edit-total-balance" aria-label="Edit total balance" title="Edit">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="dashboard-item">
                <span class="dashboard-label">Total Spent</span>
                <div class="dashboard-value-container">
                    <span class="dashboard-value spent" id="total-spent">$2,145.67</span>
                    <button class="btn-icon-small" id="edit-total-spent" aria-label="Edit total spent" title="Edit">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="dashboard-item accounts-section">
                <div class="dashboard-section-header">
                    <span class="dashboard-label">Accounts</span>
                    <div class="dashboard-section-actions">
                        <button class="btn-primary btn-small" id="add-account-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Account
                        </button>
                        <button class="btn-icon btn-small" id="toggle-accounts" aria-label="Toggle accounts">
                            <svg class="expand-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="accounts-summary" id="accounts-summary"></div>
                <div class="accounts-list-expanded" id="accounts-list-expanded" style="display: none;"></div>
            </div>
            <div class="dashboard-item categories-section">
                <div class="dashboard-section-header">
                    <span class="dashboard-label">Budget Categories</span>
                    <div class="dashboard-section-actions">
                        <button class="btn-primary btn-small" id="add-category-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Category
                        </button>
                        <button class="btn-icon btn-small" id="toggle-categories" aria-label="Toggle categories">
                            <svg class="expand-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="categories-summary" id="categories-summary"></div>
                <div class="categories-list-expanded" id="categories-list-expanded" style="display: none;"></div>
            </div>
            <div class="dashboard-item">
                <button class="btn-icon theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <svg id="theme-icon-sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg id="theme-icon-moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1>Transactions</h1>
                <div class="header-actions">
                    <button class="btn-primary" id="add-transaction-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Transaction
                    </button>
                    <div class="filter-controls">
                    <select id="filter-date-range" class="filter-select">
                        <option value="current-month" selected>Current Month</option>
                        <option value="last-7-days">Last 7 Days</option>
                        <option value="last-30-days">Last 30 Days</option>
                        <option value="last-90-days">Last 90 Days</option>
                        <option value="select-month">Select Month</option>
                        <option value="custom">Custom Range</option>
                    </select>
                    <div id="month-selector" style="display: none;">
                        <input type="month" id="filter-month" class="filter-select" style="min-width: 140px;">
                    </div>
                    <div id="custom-date-range" style="display: none;">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="date" id="filter-date-start" class="filter-select" style="min-width: 140px;">
                            <span style="color: var(--text-secondary);">to</span>
                            <input type="date" id="filter-date-end" class="filter-select" style="min-width: 140px;">
                        </div>
                    </div>
                    <select id="filter-category" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                    <select id="filter-status" class="filter-select">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="posted">Posted</option>
                        <option value="removed">Removed</option>
                    </select>
                    <select id="filter-account" class="filter-select">
                        <option value="">All Accounts</option>
                    </select>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="transactions-table" id="transactions-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="date">
                                Date
                                <span class="sort-icon">‚Üï</span>
                            </th>
                            <th class="sortable" data-sort="merchant">
                                Merchant
                                <span class="sort-icon">‚Üï</span>
                            </th>
                            <th class="sortable" data-sort="amount">
                                Amount
                                <span class="sort-icon">‚Üï</span>
                            </th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Account</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-body">
                        <!-- Transactions will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <button class="btn-secondary" id="sync-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
            Sync Transactions
        </button>
        <button class="btn-secondary" id="export-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export CSV / Excel
        </button>
        <button class="btn-danger" id="clear-data-btn" style="margin-left: auto;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            Clear All Data
        </button>
    </footer>

    <!-- Choose Account Method Modal -->
    <div class="modal" id="choose-account-method-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Add Account</h2>
                <button class="modal-close" id="close-choose-method-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                    How would you like to add this account?
                </p>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <button type="button" class="btn-primary" id="connect-plaid-btn" style="width: 100%; padding: 1.25rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12v-2a5 5 0 0 0-5-5H8a5 5 0 0 0-5 5v2"></path>
                            <rect x="3" y="9" width="18" height="11" rx="2"></rect>
                            <path d="M7 13h10"></path>
                        </svg>
                        Connect via Plaid
                    </button>
                    <button type="button" class="btn-secondary" id="manual-entry-btn" style="width: 100%; padding: 1.25rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14"></path>
                            <path d="M5 12h14"></path>
                        </svg>
                        Manual Entry
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Connect via Plaid Modal -->
    <div class="modal" id="plaid-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Connect Account via Plaid</h2>
                <button class="modal-close" id="close-plaid-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="plaid-loading" style="text-align: center; padding: 2rem 0;">
                    <div style="margin-bottom: 1.5rem;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto; color: var(--primary-color);">
                            <path d="M21 12v-2a5 5 0 0 0-5-5H8a5 5 0 0 0-5 5v2"></path>
                            <rect x="3" y="9" width="18" height="11" rx="2"></rect>
                            <path d="M7 13h10"></path>
                        </svg>
                    </div>
                    <p style="margin-bottom: 1rem; font-size: 1rem; line-height: 1.6;">
                        <strong>Connecting to your bank...</strong>
                    </p>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Initializing secure connection. Please wait.
                    </p>
                </div>
                <div id="plaid-error" style="display: none; text-align: center; padding: 2rem 0;">
                    <p style="color: var(--danger-color); margin-bottom: 1rem; font-weight: 600;">
                        Connection Error
                    </p>
                    <p id="plaid-error-message" style="color: var(--text-secondary); margin-bottom: 1.5rem;"></p>
                </div>
                <div id="plaid-link-container" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-plaid">Go Back</button>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div class="modal" id="account-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="account-modal-title">Add Account</h2>
                <button class="btn-icon" id="close-account-modal" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="account-form">
                <div class="form-group">
                    <label for="account-name">Account Name</label>
                    <input type="text" id="account-name" placeholder="e.g., Chase Checking" required>
                </div>
                <div class="form-group">
                    <label for="account-type">Account Type</label>
                    <select id="account-type" required>
                        <option value="depository">Depository</option>
                        <option value="credit">Credit</option>
                        <option value="loan">Loan</option>
                        <option value="investment">Investment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="account-subtype">Account Subtype</label>
                    <select id="account-subtype" required>
                        <option value="checking">Checking</option>
                        <option value="savings">Savings</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="account-mask">Last 4 Digits</label>
                    <input type="text" id="account-mask" placeholder="0000" maxlength="4" pattern="[0-9]{4}" required>
                    <small style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        Enter the last 4 digits of your account number
                    </small>
                </div>
                <div class="form-group">
                    <label for="account-balance">Starting Balance ($)</label>
                    <input type="number" id="account-balance" step="0.01" placeholder="0.00" required>
                    <small style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        Enter starting balance. Current balance will be calculated from transactions. For credit cards and loans, enter as negative (e.g., -245.32)
                    </small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-account">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add Category</h2>
                <button class="btn-icon" id="close-modal" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="category-form">
                <div class="form-group">
                    <label for="category-name">Category Name</label>
                    <input type="text" id="category-name" required>
                </div>
                <div class="form-group">
                    <label for="category-allocation">Monthly Allocation ($)</label>
                    <input type="number" id="category-allocation" step="0.01" min="0" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-category">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal" id="transaction-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Transaction</h2>
                <button class="btn-icon" id="close-transaction-modal" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="transaction-form">
                <div class="form-group">
                    <label for="transaction-date">Date</label>
                    <input type="date" id="transaction-date" required>
                </div>
                <div class="form-group">
                    <label for="transaction-merchant">Merchant</label>
                    <input type="text" id="transaction-merchant" placeholder="e.g., Amazon, Grocery Store" required>
                </div>
                <div class="form-group">
                    <label for="transaction-amount">Amount ($)</label>
                    <input type="number" id="transaction-amount" step="0.01" placeholder="Positive for expense, negative for income" required>
                    <small style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        Note: Positive = expense (red), Negative = income (green). Matches Plaid convention.
                    </small>
                </div>
                <div class="form-group">
                    <label for="transaction-category">Category</label>
                    <select id="transaction-category">
                        <option value="">Exempt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transaction-status">Status</label>
                    <select id="transaction-status" required>
                        <option value="posted">Posted</option>
                        <option value="pending">Pending</option>
                        <option value="removed">Removed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transaction-account">Account</label>
                    <select id="transaction-account" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-transaction">Cancel</button>
                    <button type="submit" class="btn-primary">Add Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Clear Data Warning Modal -->
    <div class="modal" id="clear-data-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Clear All Data</h2>
                <button class="modal-close" id="close-clear-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="padding: 1rem 0;">
                    <p style="margin-bottom: 1rem; font-size: 1rem; line-height: 1.6;">
                        <strong>Warning: This action cannot be undone!</strong>
                    </p>
                    <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                        This will permanently delete:
                    </p>
                    <ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary); line-height: 1.8;">
                        <li>All transactions</li>
                        <li>All accounts</li>
                        <li>All budget categories</li>
                        <li>All saved data in IndexedDB</li>
                    </ul>
                    <p style="color: var(--danger-color); font-weight: 600;">
                        Are you absolutely sure you want to proceed?
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-clear-data">Cancel</button>
                <button type="button" class="btn-danger" id="confirm-clear-data">Yes, Clear All Data</button>
            </div>
        </div>
    </div>

    <!-- Sync Accounts Selection Modal -->
    <div class="modal" id="sync-accounts-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Sync Transactions</h2>
                <button class="modal-close" id="close-sync-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                    Select which accounts to sync:
                </p>
                <div id="sync-accounts-list" style="margin-top: 0.75rem; max-height: 300px; overflow-y: auto;">
                    <!-- Account checkboxes will be populated here -->
                </div>
                <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                    <button type="button" class="btn-secondary btn-small" id="select-all-sync" style="flex: 1;">Select All</button>
                    <button type="button" class="btn-secondary btn-small" id="deselect-all-sync" style="flex: 1;">Deselect All</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-sync">Cancel</button>
                <button type="button" class="btn-primary" id="confirm-sync">Sync Selected</button>
            </div>
        </div>
    </div>

    <!-- Edit Total Balance Modal -->
    <div class="modal" id="edit-balance-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Edit Total Balance</h2>
                <button class="modal-close" id="close-balance-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select accounts to include in total balance:</label>
                    <div id="balance-accounts-list" style="margin-top: 0.75rem; max-height: 300px; overflow-y: auto;">
                        <!-- Account checkboxes will be populated here -->
                    </div>
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                        <button type="button" class="btn-secondary btn-small" id="select-all-accounts" style="flex: 1;">Select All</button>
                        <button type="button" class="btn-secondary btn-small" id="deselect-all-accounts" style="flex: 1;">Deselect All</button>
                    </div>
                </div>
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-top: 1rem;">
                    <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">
                        <strong>Total balance (selected accounts):</strong> 
                        <span id="accounts-sum-display" style="font-weight: 600; color: var(--text-primary);">$0.00</span>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-balance-edit">Cancel</button>
                <button type="button" class="btn-primary" id="save-balance">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Total Spent Modal -->
    <div class="modal" id="edit-spent-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Edit Total Spent</h2>
                <button class="modal-close" id="close-spent-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Select Categories to Include:</label>
                    <div id="spent-categories-list" style="margin-top: 0.75rem; max-height: 200px; overflow-y: auto;">
                        <!-- Category checkboxes will be populated here -->
                    </div>
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                        <button type="button" class="btn-secondary btn-small" id="select-all-categories-spent" style="flex: 1;">Select All</button>
                        <button type="button" class="btn-secondary btn-small" id="deselect-all-categories-spent" style="flex: 1;">Deselect All</button>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Select Accounts to Include:</label>
                    <div id="spent-accounts-list" style="margin-top: 0.75rem; max-height: 200px; overflow-y: auto;">
                        <!-- Account checkboxes will be populated here -->
                    </div>
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                        <button type="button" class="btn-secondary btn-small" id="select-all-accounts-spent" style="flex: 1;">Select All</button>
                        <button type="button" class="btn-secondary btn-small" id="deselect-all-accounts-spent" style="flex: 1;">Deselect All</button>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="include-exempt-spent" style="width: 18px; height: 18px; accent-color: var(--primary-color);">
                        <span>Include exempt transactions (no category)</span>
                    </label>
                </div>
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-top: 1rem;">
                    <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">
                        <strong>Total spent (selected filters):</strong> 
                        <span id="spent-sum-display" style="font-weight: 600; color: var(--text-primary);">$0.00</span>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-spent-edit">Cancel</button>
                <button type="button" class="btn-primary" id="save-spent">Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Transaction Modal -->
    <div class="modal" id="delete-transaction-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Delete Transaction</h2>
                <button class="modal-close" id="close-delete-transaction-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="padding: 1rem 0;">
                    <p style="margin-bottom: 1rem; font-size: 1rem; line-height: 1.6;">
                        <strong>Are you sure you want to delete this transaction?</strong>
                    </p>
                    <div id="delete-transaction-details" style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <!-- Transaction details will be populated here -->
                    </div>
                    <p style="color: var(--danger-color); font-weight: 600;">
                        This action cannot be undone.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-delete-transaction">Cancel</button>
                <button type="button" class="btn-danger" id="confirm-delete-transaction">Delete Transaction</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>

